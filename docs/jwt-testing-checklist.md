# JWT 인증 전환 후 테스트 체크리스트

이 문서는 세션 기반에서 JWT 기반 인증으로 전환한 후 중점적으로 테스트해야 할 항목들을 정리합니다.

## 🔴 최우선 테스트 항목 (Critical)

### 1. OAuth 로그인 플로우 및 토큰 저장

**테스트 시나리오:**
1. 메인 페이지에서 "Google로 계속하기" 버튼 클릭
2. Google 로그인 완료
3. 콜백 페이지(`/oauth/callback`)로 리다이렉트 확인
4. **브라우저 개발자 도구 → Application → Local Storage**에서 `jwt_token` 확인
5. 대시보드로 자동 이동 확인

**확인 사항:**
- ✅ URL에 `?token=<JWT_TOKEN>` 파라미터가 있는지
- ✅ localStorage에 `jwt_token`이 저장되었는지
- ✅ 토큰 값이 유효한 JWT 형식인지 (`.`으로 구분된 3부분)
- ✅ 콘솔에 "JWT 토큰 저장 완료" 메시지 출력되는지
- ✅ 사용자 정보가 정상적으로 표시되는지

**실패 시 확인:**
- URL에 `token` 파라미터가 없으면 백엔드 리다이렉트 설정 확인
- 토큰이 저장되지 않으면 브라우저 localStorage 지원 확인

---

### 2. API 요청 시 Authorization 헤더 전송

**테스트 시나리오:**
1. 로그인 완료 후 대시보드 접속
2. **브라우저 개발자 도구 → Network 탭** 열기
3. 페이지에서 API 요청 발생 (예: 사용자 정보 조회, 데이터 로드)
4. 요청 헤더 확인

**확인 사항:**
- ✅ 모든 API 요청의 `Request Headers`에 `Authorization: Bearer <token>` 포함되는지
- ✅ 토큰 값이 localStorage의 값과 일치하는지
- ✅ API 요청이 정상적으로 성공하는지 (200 OK)

**테스트할 API 엔드포인트:**
- `/api/v1/users/me` (사용자 정보)
- 기타 인증이 필요한 모든 API

**실패 시 확인:**
- `lib/api/client.ts`의 interceptor가 정상 작동하는지
- localStorage에서 토큰을 읽을 수 있는지

---

### 3. 인증 상태 확인 (checkAuth)

**테스트 시나리오:**
1. 로그인 완료 후 대시보드 접속
2. **브라우저 새로고침 (F5)**
3. 인증 상태 유지 확인

**확인 사항:**
- ✅ 새로고침 후에도 로그인 상태 유지되는지
- ✅ 사용자 정보가 그대로 표시되는지
- ✅ localStorage의 토큰이 유지되는지
- ✅ `ProtectedRoute`가 정상 작동하는지

**추가 테스트:**
- 브라우저 탭을 닫았다가 다시 열기
- 다른 페이지로 이동 후 뒤로가기

---

### 4. 로그아웃 기능

**테스트 시나리오:**
1. 로그인 상태에서 사용자 메뉴 클릭
2. "로그아웃" 버튼 클릭
3. 홈 페이지로 리다이렉트 확인

**확인 사항:**
- ✅ localStorage에서 `jwt_token`이 삭제되었는지
- ✅ 인증 상태가 `false`로 변경되었는지
- ✅ 사용자 정보가 초기화되었는지
- ✅ 홈 페이지로 정상 이동하는지

**추가 테스트:**
- 로그아웃 후 API 요청 시도 → 401 에러 발생하는지 확인

---

## 🟡 중요 테스트 항목 (Important)

### 5. 토큰 만료/무효 처리

**테스트 시나리오:**
1. localStorage에 만료된 토큰 또는 잘못된 토큰 저장
2. API 요청 발생
3. 401 에러 처리 확인

**확인 사항:**
- ✅ 401 에러 발생 시 localStorage에서 토큰이 자동 삭제되는지
- ✅ 인증 상태가 `false`로 변경되는지
- ✅ 사용자가 로그인 페이지로 리다이렉트되는지 (선택사항)

**수동 테스트 방법:**
```javascript
// 브라우저 콘솔에서 실행
localStorage.setItem('jwt_token', 'invalid_token');
// 페이지 새로고침 후 API 요청 발생 시도
```

---

### 6. 토큰 없는 상태에서 접근

**테스트 시나리오:**
1. localStorage에서 `jwt_token` 수동 삭제
2. 보호된 페이지(예: `/dashboard`) 접근 시도

**확인 사항:**
- ✅ `checkAuth()`가 토큰 없음을 감지하는지
- ✅ 인증되지 않은 사용자가 홈으로 리다이렉트되는지
- ✅ 로딩 상태가 정상적으로 표시되는지

**수동 테스트 방법:**
```javascript
// 브라우저 콘솔에서 실행
localStorage.removeItem('jwt_token');
// 보호된 페이지 접근
```

---

### 7. 여러 탭 간 인증 상태 동기화

**테스트 시나리오:**
1. 탭 A에서 로그인
2. 탭 B에서 같은 사이트 열기
3. 탭 B에서도 로그인 상태인지 확인

**확인 사항:**
- ✅ localStorage는 공유되므로 두 탭 모두 인증 상태 유지
- ✅ 한 탭에서 로그아웃 시 다른 탭도 영향받는지 (현재는 localStorage 기반이므로 영향받음)

---

## 🟢 추가 테스트 항목 (Nice to Have)

### 8. Mock 모드와 실제 모드 전환

**테스트 시나리오:**
1. `.env.local`에서 `NEXT_PUBLIC_USE_MOCK=true` 설정
2. 로그인 플로우 테스트
3. `NEXT_PUBLIC_USE_MOCK=false`로 변경 후 재테스트

**확인 사항:**
- ✅ Mock 모드에서는 토큰 저장 없이도 작동하는지
- ✅ 실제 모드에서는 정상적으로 JWT 사용하는지

---

### 9. 네트워크 오류 처리

**테스트 시나리오:**
1. 네트워크 연결 끊기 (개발자 도구 → Network → Offline)
2. API 요청 시도
3. 에러 처리 확인

**확인 사항:**
- ✅ 네트워크 오류 시 적절한 에러 메시지 표시
- ✅ 토큰이 삭제되지 않는지 (네트워크 오류는 인증 오류가 아님)

---

### 10. CORS 및 보안 헤더

**테스트 시나리오:**
1. 브라우저 개발자 도구 → Network 탭
2. API 요청의 Response Headers 확인

**확인 사항:**
- ✅ CORS 헤더가 정상적으로 설정되어 있는지
- ✅ `Access-Control-Allow-Origin`이 프론트엔드 도메인을 허용하는지
- ✅ `Access-Control-Allow-Credentials`가 필요 없어졌는지 (JWT는 헤더 사용)

---

## 📋 테스트 체크리스트 요약

### 필수 테스트 (반드시 확인)
- [ ] OAuth 로그인 후 토큰이 localStorage에 저장되는가?
- [ ] 모든 API 요청에 `Authorization: Bearer <token>` 헤더가 포함되는가?
- [ ] 페이지 새로고침 후에도 인증 상태가 유지되는가?
- [ ] 로그아웃 시 토큰이 삭제되고 인증 상태가 초기화되는가?
- [ ] 401 에러 발생 시 토큰이 자동 삭제되는가?

### 권장 테스트
- [ ] 토큰 없는 상태에서 보호된 페이지 접근 시 홈으로 리다이렉트되는가?
- [ ] 만료된 토큰으로 API 요청 시 적절히 처리되는가?
- [ ] Mock 모드와 실제 모드가 정상 작동하는가?

---

## 🐛 문제 발생 시 디버깅 방법

### 1. 토큰이 저장되지 않는 경우
```javascript
// 브라우저 콘솔에서 확인
console.log(localStorage.getItem('jwt_token'));
```

### 2. API 요청에 토큰이 포함되지 않는 경우
- Network 탭에서 Request Headers 확인
- `lib/api/client.ts`의 interceptor 확인
- 콘솔에 에러 메시지 확인

### 3. 401 에러가 계속 발생하는 경우
- 토큰이 유효한지 확인 (JWT 형식인지)
- 백엔드에서 토큰 검증이 정상 작동하는지 확인
- 토큰 만료 시간 확인

### 4. 인증 상태가 유지되지 않는 경우
- localStorage에 토큰이 있는지 확인
- `store/auth.ts`의 `checkAuth()` 함수 확인
- 브라우저 콘솔에 에러 메시지 확인

---

## 📝 테스트 결과 기록

테스트 시 다음 정보를 기록하세요:

- **테스트 날짜**: 
- **브라우저**: Chrome / Firefox / Safari / Edge
- **환경**: 개발 / 스테이징 / 프로덕션
- **결과**: ✅ 성공 / ❌ 실패
- **비고**: 특이사항, 에러 메시지 등

---

## 🔗 관련 문서

- [백엔드-프론트엔드 연결 가이드](./backend-integration.md)
- [JWT 인증 플로우](./jwt-auth-flow.md) (작성 예정)

